name: Weekly Data Update

on:
  schedule:
    - cron: '0 0 * * 0' # Runs every Sunday at midnight
  workflow_dispatch: # Allows you to run it manually from the "Actions" tab

jobs:
  update-psgc:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Important: Allows the bot to commit changes

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Scraper Dependencies
        run: pip install requests beautifulsoup4 openpyxl

      - name: Download Latest Data
        run: python scripts/download_psgc.py

      - name: Convert to CSV/SQL (Your existing scripts)
        run: |
          python xlsx_to_csv.py
          python psgc_to_sql.py > dump.sql
          # Add your Node.js generation step here if needed

      - name: Commit and Push if Changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ðŸ¤– Auto-update: New PSGC data detected"
          branch: main
          file_pattern: 'psgc_data.xlsx psgc.csv dump.sql api/*'